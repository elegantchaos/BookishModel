ROOT="$SOURCE_ROOT"
if [[ "$ROOT" == "" ]]
then
    ROOT="$PWD"
fi

CONFIG_FILE="$ROOT/Configs/BuildNumber.xcconfig"

if [[ -e "$CONFIG_FILE" ]]
then
    EXISTING=`cat $CONFIG_FILE`
else
    EXISTING=""
fi

cd "$ROOT"
BUILD=`git rev-list --count HEAD`
UPDATED="BUILD_NUMBER = $BUILD"

if [[ "$EXISTING" == "$UPDATED" ]]
then
    echo "Build number is $BUILD."
else
    echo "Updated build number to $BUILD."
    echo "$UPDATED" > "$CONFIG_FILE"
    git update-index --assume-unchanged "$CONFIG_FILE"
fi
